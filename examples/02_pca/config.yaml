# Model-specific configuration using _target_ pattern
# PCA streaming example configuration

# Set model path to current directory (for local model.py)
model_path: "src"

# WandB configuration
wandb:
  project: falcon_pca2
  group: pca_v1
  dir: ${hydra:run.dir}

# Directory configuration (relative to Hydra output directory)
directories:
  sim_dir: ${hydra:run.dir}/sim_dir
  graph_dir: ${hydra:run.dir}/graph_dir

# Training parameters
training:
  max_epochs: 20
  min_training_samples: 2048
  max_training_samples: 2048
  validation_window_size: 128
  resample_batch_size: 512
  num_conditional_samples: 3000

# Runtime configuration
runtime:
  reload: false

# Graph definition using declarative YAML
graph:
  z:
    evidence: [x]
    scaffolds: [m, n]
    simulate: 
      _class_: falcon.contrib.SNPE_A
      priors: [['uniform', -1.0, 1.0], ['uniform', -1.0, 1.0], ['uniform', -1.0, 1.0], ['uniform', -1.0, 1.0]]
      embeddings: model.E
      num_epochs: ${training.max_epochs}
      discard_samples: true
      gamma: 0.5
      lr_decay_factor: 0.1
      theta_norm: true
      batch_size: 128
      norm_momentum: 0.01
      lr: 0.01
      device: cuda
      early_stop_patience: 32
      scheduler_patience: 16
      net_type: zuko_gf # maf, nice, sospf, naf, gf
      sample_reference_posterior: true
    ray:
      num_gpus: 0.5
  
  m:
    parents: [z]
    simulate: model.Signal

  n:
    simulate: model.Noise

  x:
    parents: [m, n]
    observed: true
    simulate: model.Add

# Observations configuration
observations:
  #path: "data/observations.npz"
  path: "data/obs_10000.npz"
  index: null
