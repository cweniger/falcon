# Model-specific configuration using _target_ pattern
# PCA streaming example configuration

# Set model path to current directory (for local model.py)
model_path: "src"

# WandB configuration
logging:
  project: falcon_pca2
  group: pca_v1
  dir: ${hydra:run.dir}

# Directory configuration (relative to Hydra output directory)
paths:
  buffer: ${hydra:run.dir}/sim_dir
  graph: ${hydra:run.dir}/graph_dir

# Training buffer parameters
buffer:
  min_training_samples: 2048
  max_training_samples: 2048
  validation_window_size: 128
  resample_batch_size: 512

# Graph definition using declarative YAML
graph:
  z:
    evidence: [x]
    scaffolds: [m, n]
    simulator: 
      _class_: falcon.contrib.HypercubeMappingPrior
      priors: 
        - ['uniform', -1.0, 1.0]
        - ['uniform', -1.0, 1.0]
        - ['uniform', -1.0, 1.0]
        - ['uniform', -1.0, 1.0]
    estimator:
      _class_: falcon.contrib.SNPE_A
      embedding:
         _target_: model.E
         _input_: [x, m, n]
      embedding_keyword_order: [x, m, n]  # Transitional hack during code refactoring
      #discard_samples: true
      net_type: zuko_gf # maf, nice, sospf, naf, gf
      gamma: 0.5
      num_epochs: 10
      batch_size: 128
      lr: 0.01
      early_stop_patience: 32
      lr_decay_factor: 0.1
      scheduler_patience: 16
      #sample_reference_posterior: true
      #theta_norm: true
      #norm_momentum: 0.01
      #device: cuda
    ray:
      num_gpus: 0.5
  
  m:
    parents: [z]
    simulator: model.Signal

  n:
    simulator: model.Noise

  x:
    parents: [m, n]
    simulator: model.Add

## Observations configuration
observations:
  #path: "data/observations.npz"
  path: "data/obs_10000.npz"
  index: null

sample:
  prior:
    n: 1000
    path: samples_prior.joblib
  proposal:
    n: 1000
    path: samples_proposal.joblib
  posterior:
    n: 10000
    path: samples_posterior.joblib