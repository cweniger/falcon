# Model-specific configuration using _target_ pattern
# Updated to the new Falcon config schema

# Set model path to current directory (for local model.py)
model_path: "src"

# Ray initialization parameters
ray:
  init:
    address: null   # set to None for local single-node

# Directory configuration
paths:
  run_root: ${hydra:run.dir}
  buffer: ${paths.run_root}/sim_dir         # same location as old 'sim_dir'
  graph: ${paths.run_root}/graph_dir        # same location as old 'graph_dir'

# WandB / logging configuration (renamed)
logging:
  project: falcon4
  group: v2_frozen
  dir: ${paths.run_root}

# (Optional) Training buffer parameters â€” leave defaulted if unused in this example
buffer:
  min_training_samples: 8192                # aligned with old n_train / num_initial_samples
  max_training_samples: 8192
  validation_window_size: 256               # old num_val_samples
  resample_batch_size: 256                  # old num_resims

# Graph definition using declarative YAML
graph:
  z:
    evidence: [x]
    # No explicit parents (latent prior); scaffolds not used here
    simulator:
      _target_: falcon.contrib.HypercubeMappingPrior
      priors:
        - ['uniform', -100.0, 100.0]
        - ['uniform', -100.0, 100.0]
        - ['uniform', -100.0, 100.0]
    estimator:
      _target_: falcon.contrib.SNPE_A
      embedding:
        _target_: model.E
        _input_: [x]                        # equivalent to old 'embeddings: model.E'
      num_epochs: 10                        # from training.max_epochs
      #discard_samples: true                 # from old config
      gamma: 0.5
      lr_decay_factor: 0.1
      lr: 0.01
      theta_norm: true
      norm_momentum: 0.001
      early_stop_patience: 32
      scheduler_patience: 16
      net_type: zuko_nice
    ray:
      num_gpus: 0.                           # from actor_config.num_gpus

  x:
    parents: [z]
    simulator:
      _target_: model.Simulate
      npar: 3
    observed: "data/obs_3.npy"  # from observations.path
    # NOTE: old 'observations.index: null' = use full arrays; keep default behavior.
    ray:
      num_gpus: 0

sample:
  posterior:
    n: 10000
    path: samples_posterior.joblib