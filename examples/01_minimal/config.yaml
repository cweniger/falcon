# Model-specific configuration using _target_ pattern
# Self-contained configuration for this model

# Set model path to current directory (for local model.py)
model_path: "src"

# WandB configuration
wandb:
  project: falcon4
  group: v2_frozen
  dir: ${hydra:run.dir}

# Directory configuration (relative to Hydra output directory)
directories:
  sim_dir: ${hydra:run.dir}/sim_dir
  graph_dir: ${hydra:run.dir}/graph_dir

# Training parameters
training:
  max_epochs: 150
  num_resims: 256
  n_train: 8192
  num_initial_samples: 8192
  num_val_samples: 256
  num_conditional_samples: 10000


# Runtime configuration
runtime:
  reload: false

# Graph definition using declarative YAML
graph:
  z:
    parents: []
    evidence: [x]
    observed: false
    resample: false
    create_module: falcon.contrib.SNPE_A
    module_config:
      priors: [['uniform', -100.0, 100.0], ['uniform', -100.0, 100.0], ['uniform', -100.0, 100.0]]
      embeddings: model.E
      num_epochs: ${training.max_epochs}
      discard_samples: true
      gamma: 0.5
      lr_decay_factor: 0.1
      lr: 0.01
      theta_norm: true
      norm_momentum: 0.001
      early_stop_patience: 32
      scheduler_patience: 16
      net_type: zuko_nice
    actor_config:
      num_gpus: 1  # CPU-only for this node
  
  x:
    parents: [z]
    evidence: []
    observed: true
    resample: false
    create_module: model.Simulate
    module_config:
      npar: 3
      sigma: 0.1
    actor_config:
      num_gpus: 0


# Observations configuration
# index: null uses full arrays, index: 0 selects batch element 0
observations:
  path: "data/observations_zero.npz"
  index: null
