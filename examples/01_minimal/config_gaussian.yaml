# =============================================================================
# Falcon Example Configuration: 01_minimal (Gaussian Posterior)
# -----------------------------------------------------------------------------
# Same as config.yaml but using SNPE_gaussian instead of SNPE_A.
#
# SNPE_gaussian uses a full covariance Gaussian posterior instead of
# normalizing flows. Benefits:
#   • Simpler and more interpretable
#   • Covariance matrix shows parameter correlations directly
#   • Eigenvalue-based tempered sampling for exploration
#
# Usage:
#   falcon launch --config-name config_gaussian --run-dir outputs/gaussian_run
#   falcon sample posterior --run-dir outputs/gaussian_run
# =============================================================================

# -----------------------------------------------------------------------------
# Logging configuration
# -----------------------------------------------------------------------------
logging:
  wandb:
    enabled: false
    project: falcon_examples
    group: 01_minimal_gaussian
    dir: ${run_dir}
  local:
    enabled: true
    dir: ${paths.graph}

# -----------------------------------------------------------------------------
# Directory configuration
# -----------------------------------------------------------------------------
paths:
  import: "./src"
  buffer: ${run_dir}/sim_dir
  graph: ${run_dir}/graph_dir
  samples: ${run_dir}/samples_dir

# -----------------------------------------------------------------------------
# Training buffer parameters
# -----------------------------------------------------------------------------
buffer:
  min_training_samples: 4096
  max_training_samples: 32768
  validation_window_size: 256
  resample_batch_size: 128
  keep_resampling: true
  resample_interval: 10

# -----------------------------------------------------------------------------
# Graph definition using SNPE_gaussian estimator
# -----------------------------------------------------------------------------
graph:
  z:
    evidence: [x]

    simulator:
      _target_: falcon.contrib.HypercubeMappingPrior
      priors:
        - ['uniform', -100.0, 100.0]
        - ['uniform', -100.0, 100.0]
        - ['uniform', -100.0, 100.0]

    estimator:
      _target_: falcon.contrib.SNPE_gaussian
      loop:
        num_epochs: 300
        batch_size: 128
        early_stop_patience: 32
      network:
        hidden_dim: 128               # MLP hidden layer dimension
        num_layers: 3                 # Number of hidden layers
        momentum: 0.01                # EMA momentum for running statistics
        min_var: 1.0e-6               # Minimum variance for numerical stability
        eig_update_freq: 1            # Eigendecomposition update frequency
        embedding:
          _target_: model.E
          _input_: [x]
      optimizer:
        lr: 0.01
        lr_decay_factor: 0.5
        scheduler_patience: 16
      inference:
        gamma: 0.5                    # Tempering for proposal sampling
        discard_samples: false
        log_ratio_threshold: -20.0

    ray:
      num_gpus: 0

  x:
    parents: [z]
    simulator:
      _target_: model.Simulate
      npar: 3
    observed: "./data/mock_data.npz['x']"

# -----------------------------------------------------------------------------
# Sampling configuration
# -----------------------------------------------------------------------------
sample:
  posterior:
    n: 1000
